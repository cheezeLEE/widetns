<?xml version="1.0" encoding="UTF-8"?>

<!-- DTD 선언 -->
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
	<mapper namespace="com.widetns.projmp.dao.ProjmpDAO">
	
	<!-- 프로젝트 목록 조회 -->
	<select id="projList" resultType="hashmap">
		SELECT pb.prj_name, pb.pm_name, pb.prj_start, pb.prj_end 
		FROM project_mapping pm 
			JOIN project_basic pb ON pb.prj_num = pm.prj_num
			JOIN employee e ON pm.emp_num = e.emp_num
		WHERE pb.pb_deleted_yn = 'n'
		GROUP BY pb.prj_name;
	</select>

	<!-- 사원 목록 조회 -->
	<select id="empList" resultType="hashmap">
		SELECT * FROM employee
	</select>
	
	<!-- 사원 정보 상세보기 페이지 -->
	<select id="empDetail" resultType="hashmap">
		SELECT * FROM employee WHERE emp_num = 1
	</select>
	
	<!-- 사원 정보 수정 -->
	<update id="empUpdate" parameterType="hashmap">
		UPDATE employee SET 
			addr1 = #{addr1}, addr2 = #{addr2}, addr3 = #{addr3}, pos = #{pos}, dept = #{dept},
			career = #{career}, emp_level = #{emp_level}, cert = #{cert}, file_name = #{file_name}
		WHERE emp_num = 1
	</update>
	
	<!-- 사용할 수 있는 기술 검색 -->
	<select id="empTech" resultType="hashmap">
		SELECT * FROM employee_tech WHERE emp_num = 1 AND et_deleted_yn = 'n'
	</select>
	
	<!-- 공통코드에 있는 전체 기술목록 표시 -->
	<select id="allTech" resultType="hashmap">
		SELECT code_name FROM common_code WHERE cc_deleted_yn = 'n'
	</select>
		
	<!-- 사원별 참여 프로젝트 목록 -->
	<select id="empPrj" resultType="hashmap">
		SELECT * FROM project_basic pb JOIN project_mapping pm ON pb.prj_num = pm.prj_num WHERE pb.pb_deleted_yn = 'n' AND pm.emp_num = 1
	</select>
	
	<!-- 공통코드 테이블의 모든 기술목록 -->
	<select id="comTech" resultType="hashmap">
		SELECT code_name FROM common_code 
	</select>
	
	<!-- 기술 추가 버튼 동작 : 기술 1개 추가 -->
	<insert id="addTech" parameterType="hashmap">
		INSERT INTO employee_tech(emp_num, tech_code, tech_level, et_reg_writer) 
		VALUES(1, #{tech_code}, #{tech_level}, '이나나')
	</insert>
	
	<!-- 기술 삭제 버튼 동작 : 기술 1개 이상 동시 삭제 가능 -->
	<delete id="delTech" parameterType="string">
		DELETE FROM employee_tech
		WHERE emp_num = 1 AND tech_code = #{tech_code}
	</delete>
</mapper>